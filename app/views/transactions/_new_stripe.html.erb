<%= form_for transaction, :url => page_create_transaction_path, :html => {:autocomplete => "off"} do |f| %>
  <div class='card_errors notification notification-danger' style='display:none'>
    <span class="payment-errors"></span>
  </div>

  <% if transaction.errors.any? %>
    <div id="error_explanation" class="notification notification-danger">
      <h2><%= pluralize(transaction.errors.count, "error") %> prohibited this page from being saved:</h2>

      <ul>
      <% transaction.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% if flash[:status] %>
  <div class="notification notification-danger">
    <p><%= flash[:status] %></p>
  </div>
  <% end %>

  <%= render 'form', { :f => f, :stack => stack, :shipping_cost => shipping_cost } %>
<% end %>

<% unless transaction.stack_ga_id.blank? %>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '<%= transaction.stack_ga_id %>']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
<% end %>

<%= javascript_include_tag "https://js.stripe.com/v2/" %>

<%= javascript_include_tag "transactions-stripe" %>

<script type="text/javascript">
  Stripe.setPublishableKey('<%= stack.user.stripe_api_key %>');
</script>
